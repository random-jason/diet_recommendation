# OCR热量识别功能使用指南

## 功能概述

OCR热量识别功能允许用户通过拍摄或上传包含食物信息的图片，自动识别其中的热量信息，大大简化了餐食记录的过程。

## 主要特性

### 1. 多OCR引擎支持
- **Tesseract OCR**: 开源OCR引擎，支持中英文识别
- **PaddleOCR**: 百度开源OCR，对中文识别效果优秀
- **EasyOCR**: 简单易用的OCR库，支持多语言

### 2. 智能验证机制
- **多级验证**: 结合OCR结果、食物数据库和用户学习数据
- **置信度评估**: 为每个识别结果提供置信度评分
- **用户修正**: 支持用户手动修正识别结果

### 3. 学习优化系统
- **用户反馈学习**: 记录用户修正，提高后续识别准确性
- **数据库匹配**: 与内置食物数据库进行智能匹配
- **模式识别**: 识别多种热量表示格式

## 使用方法

### 1. 启动OCR功能

#### 在移动端界面：
1. 打开应用，进入"记录"页面
2. 在食物输入框右侧找到"📷"按钮
3. 点击按钮打开OCR识别界面

#### 在桌面端界面：
1. 在主界面选择"OCR热量识别"功能
2. 或通过菜单栏访问OCR功能

### 2. 上传图片

1. 点击"选择图片"按钮
2. 选择包含食物信息的图片文件
3. 支持的格式：JPG、JPEG、PNG、BMP、GIF
4. 图片将显示在预览区域

### 3. 开始识别

1. 确认图片选择正确后，点击"开始识别"按钮
2. 系统将使用多个OCR引擎进行识别
3. 识别过程中会显示进度条和状态信息
4. 识别完成后显示结果

### 4. 查看和编辑结果

#### 识别结果表格：
- **食物名称**: 识别到的食物名称
- **热量**: 识别到的热量数值（卡路里）
- **置信度**: 识别结果的置信度（0-1）
- **来源**: 数据来源（OCR、数据库、用户确认）

#### 详细信息：
- OCR识别过程详情
- 各引擎的识别结果
- 处理时间和整体置信度

#### 建议：
- 系统提供的改进建议
- 识别准确性提示
- 手动输入建议

### 5. 编辑和确认结果

#### 编辑结果：
1. 双击表格中的任意行或选择后点击"编辑结果"
2. 在弹出的对话框中修改食物名称、热量和置信度
3. 点击"保存"确认修改

#### 确认结果：
1. 检查所有识别结果是否正确
2. 点击"确认结果"按钮
3. 系统将保存到餐食记录中

## 识别准确性优化

### 1. 图片质量要求

#### 推荐条件：
- **清晰度**: 图片清晰，文字可读
- **对比度**: 文字与背景对比明显
- **角度**: 文字水平，避免倾斜
- **光照**: 光线充足，避免阴影

#### 避免的情况：
- 模糊不清的图片
- 文字过小或过大的图片
- 严重倾斜的图片
- 光线过暗或过亮的图片

### 2. 文字格式支持

#### 支持的热量表示格式：
- `130卡路里`
- `155 kcal`
- `52千卡`
- `42大卡`
- `110 KJ` (千焦)
- `76卡`

#### 支持的食物名称：
- 中文食物名称：米饭、鸡蛋、苹果等
- 英文食物名称：rice、egg、apple等
- 混合格式：米饭 130卡路里

### 3. 提高识别准确性的技巧

#### 图片预处理：
- 确保图片中的文字清晰可见
- 避免复杂的背景干扰
- 保持文字区域的完整性

#### 结果验证：
- 仔细检查识别结果
- 及时修正错误信息
- 利用数据库匹配功能

#### 学习优化：
- 经常使用修正功能
- 系统会学习您的修正习惯
- 提高后续识别的准确性

## 故障排除

### 1. 常见问题

#### 识别失败：
- **原因**: 图片质量差、OCR引擎不可用
- **解决**: 检查图片质量，确保OCR依赖已安装

#### 识别结果不准确：
- **原因**: 图片模糊、文字格式特殊
- **解决**: 重新拍摄清晰图片，手动修正结果

#### 无法打开OCR界面：
- **原因**: 依赖包未安装、模块初始化失败
- **解决**: 检查requirements.txt中的依赖是否已安装

### 2. 依赖安装

确保已安装以下依赖包：

```bash
pip install pytesseract>=0.3.10
pip install opencv-python>=4.8.0
pip install paddleocr>=2.7.0
pip install easyocr>=1.7.0
```

#### Tesseract安装：
- **Windows**: 下载Tesseract安装包并添加到PATH
- **macOS**: `brew install tesseract`
- **Linux**: `sudo apt-get install tesseract-ocr`

### 3. 性能优化

#### 提高识别速度：
- 使用较小的图片文件
- 选择清晰的图片
- 避免过于复杂的图片

#### 提高识别准确性：
- 使用标准格式的食物标签
- 保持文字清晰可读
- 及时修正错误结果

## 技术架构

### 1. 模块结构

```
modules/ocr_calorie_recognition.py  # OCR识别模块
gui/ocr_calorie_gui.py            # OCR GUI界面
test_ocr_system.py                # 测试脚本
```

### 2. 核心组件

#### OCRCalorieRecognitionModule:
- 多OCR引擎集成
- 图片预处理
- 热量信息提取
- 数据库匹配
- 用户学习系统

#### OCRCalorieGUI:
- 图片上传界面
- 识别结果展示
- 结果编辑功能
- 用户交互处理

### 3. 数据流程

1. **图片上传** → 图片预处理
2. **OCR识别** → 多引擎并行识别
3. **文本提取** → 热量信息解析
4. **数据库匹配** → 食物信息验证
5. **用户确认** → 结果保存和学习

## 未来改进计划

### 1. 功能增强
- 支持更多图片格式
- 增加批量识别功能
- 支持手写文字识别
- 集成营养信息识别

### 2. 性能优化
- 优化识别算法
- 提高处理速度
- 减少内存占用
- 支持GPU加速

### 3. 用户体验
- 改进界面设计
- 增加语音输入
- 支持离线识别
- 提供更多个性化选项

## 联系支持

如果您在使用OCR功能时遇到问题，请：

1. 查看本文档的故障排除部分
2. 运行测试脚本检查系统状态
3. 检查依赖包是否正确安装
4. 提供详细的错误信息和截图

---

*最后更新: 2024年12月*
